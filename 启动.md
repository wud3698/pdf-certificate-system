# PDFè¯ä¹¦ç®¡ç†ç³»ç»Ÿå¯åŠ¨æŒ‡å—

## ğŸš€ ç³»ç»Ÿå¯åŠ¨æ­¥éª¤

### 1. ç¯å¢ƒå‡†å¤‡
```bash
# ç¡®ä¿åœ¨é¡¹ç›®ç›®å½•
cd /www/pdf

# æ£€æŸ¥Pythonç¯å¢ƒ
python3 --version
```

### 2. å®‰è£…é¡¹ç›®ä¾èµ–
```bash
# å®‰è£…Pythonä¾èµ–åŒ…
pip install -r requirements.txt
```

### 3. æ•°æ®åº“é…ç½®
```bash
# åˆå§‹åŒ–æ•°æ®åº“
python update_database.py
```

### 4. å¯åŠ¨åº”ç”¨

#### å¼€å‘ç¯å¢ƒå¯åŠ¨
```bash
# å¯åŠ¨Flaskå¼€å‘æœåŠ¡å™¨
python run.py
```

#### ç”Ÿäº§ç¯å¢ƒå¯åŠ¨
```bash
# æ–¹å¼1ï¼šä½¿ç”¨ç”Ÿäº§ç¯å¢ƒå¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
chmod +x start_production.sh
./start_production.sh

# æ–¹å¼2ï¼šç›´æ¥ä½¿ç”¨Gunicornå‘½ä»¤
gunicorn --config gunicorn_config.py wsgi:application

# æ–¹å¼3ï¼šåå°è¿è¡Œï¼ˆå®ˆæŠ¤è¿›ç¨‹ï¼‰
nohup gunicorn --config gunicorn_config.py wsgi:application > logs/app.log 2>&1 &


&& nohup python3 run_production_dev.py > app.log 2>&1 &
```

## ğŸ“¦ LibreOffice å®‰è£…é…ç½®

### âš ï¸ é‡è¦è¯´æ˜
è¯ä¹¦ç”ŸæˆåŠŸèƒ½éœ€è¦ LibreOffice æ”¯æŒï¼Œç”¨äºå°† Word æ–‡æ¡£è½¬æ¢ä¸º PDF æ ¼å¼ã€‚

### æ–¹æ³•ä¸€ï¼šå®Œæ•´å®‰è£…ï¼ˆæ¨èï¼‰
```bash
# 1. æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
sudo apt update

# 2. å®‰è£… LibreOffice å®Œæ•´ç‰ˆ
sudo apt install -y libreoffice

# 3. å®‰è£…ä¸­æ–‡è¯­è¨€åŒ…å’Œå­—ä½“
sudo apt install -y libreoffice-l10n-zh-cn fonts-wqy-microhei fonts-wqy-zenhei

# 4. éªŒè¯å®‰è£…
soffice --version
which soffice
```

### æ–¹æ³•äºŒï¼šæœ€å°åŒ–å®‰è£…
```bash
# ä»…å®‰è£…æ–‡æ¡£è½¬æ¢æ‰€éœ€ç»„ä»¶
sudo apt install -y libreoffice-writer libreoffice-core libreoffice-common

# å®‰è£…ä¸­æ–‡å­—ä½“æ”¯æŒ
sudo apt install -y fonts-wqy-microhei fonts-wqy-zenhei fonts-arphic-ukai fonts-arphic-uming
```

### æ–¹æ³•ä¸‰ï¼šä¸€é”®å®‰è£…å‘½ä»¤
```bash
# ä¸€æ¡å‘½ä»¤å®‰è£…æ‰€æœ‰å¿…è¦ç»„ä»¶
sudo apt update && sudo apt install -y libreoffice libreoffice-l10n-zh-cn fonts-wqy-microhei fonts-wqy-zenhei && soffice --version
```

## ğŸ”§ å®‰è£…åé…ç½®

### å­—ä½“é…ç½®
```bash
# å®‰è£…æ›´å¤šä¸­æ–‡å­—ä½“ï¼ˆå¯é€‰ï¼‰
sudo apt install -y fonts-noto-cjk fonts-liberation ttf-mscorefonts-installer

# åˆ·æ–°å­—ä½“ç¼“å­˜
sudo fc-cache -fv
```

### æƒé™é…ç½®
```bash
# åˆ›å»º LibreOffice é…ç½®ç›®å½•
mkdir -p ~/.config/libreoffice

# è®¾ç½®é€‚å½“æƒé™
chmod -R 755 ~/.config/libreoffice

# ç¡®ä¿ä¸´æ—¶ç›®å½•æƒé™
sudo chmod 777 /tmp
```

## âœ… éªŒè¯å®‰è£…

### 1. æ£€æŸ¥ LibreOffice
```bash
# æ£€æŸ¥ç‰ˆæœ¬
soffice --version

# æ£€æŸ¥å‘½ä»¤ä½ç½®
which soffice

# æ£€æŸ¥ä¸­æ–‡å­—ä½“
fc-list | grep -i "ä»¿å®‹\|å®‹ä½“\|é»‘ä½“"
```

### 2. æµ‹è¯•æ–‡æ¡£è½¬æ¢
```bash
# åœ¨é¡¹ç›®ç›®å½•ä¸­æµ‹è¯•è½¬æ¢åŠŸèƒ½
cd /www/pdf
echo "æµ‹è¯•æ–‡æ¡£å†…å®¹" > test.txt
soffice --headless --convert-to pdf test.txt
ls -la test.pdf
```

### 3. æµ‹è¯•è¯ä¹¦ç”Ÿæˆ
```bash
# å¯åŠ¨åº”ç”¨åè®¿é—®ç®¡ç†åå°
# http://localhost:5000/admin
# ä¸Šä¼ æµ‹è¯•æ•°æ®å¹¶å°è¯•ç”Ÿæˆè¯ä¹¦
```

## ğŸ› å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜1ï¼šsoffice å‘½ä»¤æœªæ‰¾åˆ°
```bash
# é‡æ–°å®‰è£… LibreOffice
sudo apt install --reinstall libreoffice

# æ£€æŸ¥PATHç¯å¢ƒå˜é‡
echo $PATH
which soffice
```

### é—®é¢˜2ï¼šè½¬æ¢å¤±è´¥
```bash
# æ£€æŸ¥æƒé™
sudo chown -R $USER:$USER ~/.config/libreoffice

# è®¾ç½®ä¸´æ—¶ç›®å½•
export TMPDIR=/www/pdf/uploads/temp
mkdir -p /www/pdf/uploads/temp
chmod 755 /www/pdf/uploads/temp
```

### é—®é¢˜3ï¼šä¸­æ–‡å­—ä½“æ˜¾ç¤ºé—®é¢˜
```bash
# å®‰è£…æ›´å¤šå­—ä½“åŒ…
sudo apt install -y fonts-wqy-microhei fonts-wqy-zenhei
sudo apt install -y fonts-arphic-ukai fonts-arphic-uming
sudo fc-cache -fv
```

### é—®é¢˜4ï¼šæƒé™ä¸è¶³
```bash
# ä¿®å¤ç›®å½•æƒé™
sudo chown -R www-data:www-data /www/pdf/uploads
sudo chmod -R 755 /www/pdf/uploads

# æˆ–è€…ä½¿ç”¨å½“å‰ç”¨æˆ·
sudo chown -R $USER:$USER /www/pdf/uploads
```

## ğŸ¯ å®Œæ•´å¯åŠ¨æµç¨‹

### é¦–æ¬¡éƒ¨ç½²ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
```bash
# 1. æ›´æ–°ç³»ç»Ÿ
sudo apt update

# 2. å®‰è£… LibreOffice
sudo apt install -y libreoffice libreoffice-l10n-zh-cn fonts-wqy-microhei fonts-wqy-zenhei

# 3. åˆ‡æ¢åˆ°é¡¹ç›®ç›®å½•
cd /www/pdf

# 4. å®‰è£…Pythonä¾èµ–
pip install -r requirements.txt

# 5. åˆå§‹åŒ–æ•°æ®åº“
python update_database.py

# 6. éªŒè¯ LibreOffice
soffice --version

# 7. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
python run.py
```

### é¦–æ¬¡éƒ¨ç½²ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
```bash
# 1. æ›´æ–°ç³»ç»Ÿ
sudo apt update

# 2. å®‰è£… LibreOffice
sudo apt install -y libreoffice libreoffice-l10n-zh-cn fonts-wqy-microhei fonts-wqy-zenhei

# 3. åˆ‡æ¢åˆ°é¡¹ç›®ç›®å½•
cd /www/pdf

# 4. å®‰è£…Pythonä¾èµ–ï¼ˆåŒ…å«gunicornï¼‰
pip install -r requirements.txt

# 5. åˆå§‹åŒ–æ•°æ®åº“
python update_database.py

# 6. éªŒè¯ LibreOffice
soffice --version

# 7. åˆ›å»ºæ—¥å¿—ç›®å½•
mkdir -p logs

# 8. è®¾ç½®è„šæœ¬æƒé™
chmod +x start_production.sh

# 9. å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
./start_production.sh
```

### æ—¥å¸¸å¯åŠ¨

#### å¼€å‘ç¯å¢ƒ
```bash
# åˆ‡æ¢åˆ°é¡¹ç›®ç›®å½•
cd /www/pdf

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
python run.py
```

#### ç”Ÿäº§ç¯å¢ƒ
```bash
# åˆ‡æ¢åˆ°é¡¹ç›®ç›®å½•
cd /www/pdf

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
./start_production.sh
```

## ğŸ“‹ ç³»ç»Ÿä¿¡æ¯

### é»˜è®¤ç®¡ç†å‘˜è´¦å·
- **ç”¨æˆ·å**: `admin`
- **å¯†ç **: `admin123`
- **ç™»å½•åœ°å€**: http://localhost:5000/admin

### é‡è¦ç›®å½•
- **ä¸Šä¼ ç›®å½•**: `/www/pdf/uploads/`
- **æ¨¡æ¿ç›®å½•**: `/www/pdf/uploads/templates/`
- **è¯ä¹¦ç›®å½•**: `/www/pdf/uploads/certificates/`
- **å›¾ç‰‡ç›®å½•**: `/www/pdf/uploads/participant_images/`

### è®¿é—®åœ°å€
- **å‰å°**: http://localhost:5000
- **åå°**: http://localhost:5000/admin

## ğŸ” æ•…éšœæ’é™¤æ£€æŸ¥æ¸…å•

- [ ] Python 3.8+ å·²å®‰è£…
- [ ] MySQL æ•°æ®åº“å·²é…ç½®å¹¶è¿è¡Œ
- [ ] LibreOffice å·²å®‰è£…ä¸” `soffice` å‘½ä»¤å¯ç”¨
- [ ] é¡¹ç›®ä¾èµ–åŒ…å·²å®‰è£… (`pip install -r requirements.txt`)
- [ ] æ•°æ®åº“å·²åˆå§‹åŒ– (`python update_database.py`)
- [ ] ä¸Šä¼ ç›®å½•æƒé™æ­£ç¡® (`chmod 755 uploads/`)
- [ ] ä¸­æ–‡å­—ä½“å·²å®‰è£…
- [ ] é˜²ç«å¢™å…è®¸5000ç«¯å£è®¿é—®

## ğŸš€ ç”Ÿäº§ç¯å¢ƒé…ç½®è¯´æ˜

### Gunicorné…ç½®ç‰¹æ€§
- **å¤šè¿›ç¨‹å¹¶å‘**ï¼šå·¥ä½œè¿›ç¨‹æ•° = CPUæ ¸å¿ƒæ•° Ã— 2 + 1
- **è¶…æ—¶è®¾ç½®**ï¼š30åˆ†é’Ÿè¶…æ—¶ï¼Œæ”¯æŒæ‰¹é‡è¯ä¹¦ç”Ÿæˆ
- **è‡ªåŠ¨é‡å¯**ï¼šworkerè¿›ç¨‹è‡ªåŠ¨é‡å¯ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼
- **æ—¥å¿—è®°å½•**ï¼šå®Œæ•´çš„è®¿é—®å’Œé”™è¯¯æ—¥å¿—

### æ€§èƒ½å¯¹æ¯”
| é…ç½®é¡¹ | å¼€å‘ç¯å¢ƒ | ç”Ÿäº§ç¯å¢ƒ |
|--------|----------|----------|
| å¹¶å‘èƒ½åŠ› | å•çº¿ç¨‹ | å¤šè¿›ç¨‹ |
| è¶…æ—¶æ—¶é—´ | 30ç§’ | 1800ç§’ |
| æ‰¹é‡å¤„ç† | å®¹æ˜“è¶…æ—¶ | æ”¯æŒå¤§æ‰¹é‡ |
| ç¨³å®šæ€§ | ä¸€èˆ¬ | é«˜ |

### ç”Ÿäº§ç¯å¢ƒè¿›ç¨‹ç®¡ç†
```bash
# æŸ¥çœ‹Gunicornè¿›ç¨‹
ps aux | grep gunicorn

# åœæ­¢æ‰€æœ‰Gunicornè¿›ç¨‹
pkill -f gunicorn

# é‡å¯ç”Ÿäº§æœåŠ¡å™¨
./start_production.sh

# æŸ¥çœ‹æ—¥å¿—
tail -f logs/gunicorn_access.log
tail -f logs/gunicorn_error.log
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æŒ‰ä»¥ä¸‹é¡ºåºæ£€æŸ¥ï¼š
1. æŸ¥çœ‹åº”ç”¨æ—¥å¿—è¾“å‡º
2. æ£€æŸ¥ LibreOffice å®‰è£…çŠ¶æ€
3. éªŒè¯æ–‡ä»¶æƒé™è®¾ç½®
4. æµ‹è¯•æ•°æ®åº“è¿æ¥
5. æŸ¥çœ‹ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ

### ç”Ÿäº§ç¯å¢ƒæ•…éšœæ’é™¤
- **è¶…æ—¶é—®é¢˜**ï¼šæ£€æŸ¥Gunicorné…ç½®ä¸­çš„timeoutè®¾ç½®
- **è¿›ç¨‹å´©æºƒ**ï¼šæŸ¥çœ‹ `logs/gunicorn_error.log` é”™è¯¯æ—¥å¿—
- **æ€§èƒ½é—®é¢˜**ï¼šè°ƒæ•´workerè¿›ç¨‹æ•°é‡
- **å†…å­˜ä¸è¶³**ï¼šç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
